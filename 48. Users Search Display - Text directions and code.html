<p>Make the turbolinks:load update for application.js and friends.js (if using Rails 4)<br>Code for friends.js below<br>$(document).on('turbolinks:load', function() {<br>&nbsp; $('#friend-lookup-form').on('ajax:complete', function(event, data, status){<br>&nbsp; &nbsp; $('#results').html(data.responseText)<br>&nbsp; })<br>})</p>

<p>Add in the code to display user data in the _result.html.erb view:<br>&lt;% if @users %&gt;<br>&nbsp; &lt;div id="friend-lookup-results" class="well results-block col-md-10"&gt;<br>&nbsp; &nbsp; &lt;table class="search-results-table col-md-12"&gt;<br>&nbsp; &nbsp; &nbsp; &lt;tbody&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;% @users.each do |user| %&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;tr&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;&lt;strong&gt;Name:&lt;/strong&gt; &lt;%= user.full_name %&gt;&lt;/td&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;&lt;strong&gt;Email:&lt;/strong&gt; &lt;%= user.email %&gt;&lt;/td&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;&lt;strong&gt;Profile:&lt;/strong&gt; &lt;%= link_to "View Profile", "#",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; class: "btn btn-xs btn-success" %&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;% if current_user.not_friends_with?(user.id) %&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;%= link_to "Add as my friend",&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add_friend_path(user: current_user, friend: user),<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; class: "btn btn-xs btn-success", method: :post %&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;% else %&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;span class="label label-primary"&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; You are friends<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/span&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;% end %&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/td&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/tr&gt;<br>&nbsp; &nbsp; &nbsp; &nbsp; &lt;% end %&gt;<br>&nbsp; &nbsp; &nbsp; &lt;/tbody&gt;<br>&nbsp; &nbsp; &lt;/table&gt;<br>&nbsp; &lt;/div&gt;<br>&lt;% end %&gt;</p>

<p>Add the except current users method in the user.rb file:</p>

<p>&nbsp; def except_current_user(users)<br>&nbsp; &nbsp; users.reject { |user| user.id == self.id }<br>&nbsp; end</p>

<p>Update the search method to accomodate this (search under users_controller):<br>&nbsp; def search<br>&nbsp; &nbsp; if params[:search_param].blank?<br>&nbsp; &nbsp; &nbsp; flash.now[:danger] = "You have entered an empty search string"<br>&nbsp; &nbsp; else<br>&nbsp; &nbsp; &nbsp; @users = User.search(params[:search_param])<br>&nbsp; &nbsp; &nbsp; @users = current_user.except_current_user(@users)<br>&nbsp; &nbsp; &nbsp; flash.now[:danger] = "No users match this search criteria" if @users.blank?<br>&nbsp; &nbsp; end<br>&nbsp; &nbsp; respond_to do |format|<br>&nbsp; &nbsp; &nbsp; format.js { render partial: 'friends/result' }<br>&nbsp; &nbsp; end<br>&nbsp; end</p>

<p>Add the route for add_friend_path in config/routes.rb file:</p>

<p>post 'add_friend', to: 'users#add_friend'</p>

<p>Add in the not_friends_with method in the user.rb model file:</p>

<p>&nbsp; def not_friends_with?(friend_id)<br>&nbsp; &nbsp; friendships.where(friend_id: friend_id).count &lt; 1<br>&nbsp; end</p>